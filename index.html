<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>LCDR LIVE DATA</title>
  <style>
    body {
      background: url('https://raw.githubusercontent.com/iDLC1990/status-dashboard/main/pexels-iriser-1366957.jpg') no-repeat center center fixed;
      background-size: cover;
      color:#fff;
      font-family: Arial, sans-serif;
      transition: background 1s ease-in-out;
    }
    body::before {
      content:"";
      position: fixed;
      top:0;
      left:0;
      width:100%;
      height:100%;
      background: rgba(0,0,0,0.5);
      z-index:-1;
    }
    .header {
      display:flex;
      justify-content:space-between;
      align-items:center;
      padding:20px 10%;
      background-color: rgba(17,17,17,0.7);
    }
    .header h1 { margin:0; color:#008080; font-size:24px; }
    .date-info { color:#008080; font-size:18px; }
    .table-container { width:80%; margin:24px auto; }
    .table-header { background-color:#008080; color:#000; font-weight:bold; font-size:18px; padding:10px 16px; border-radius:10px 10px 0 0; }
    .toggle-btn { margin:8px 0; font-size:20px; cursor:pointer; background:none; border:none; color:#0ff; }
    table { width:100%; border-collapse:collapse; background-color:#5555559e; border-radius:0 0 10px 10px; }
    table, th, td { border:1px solid #fff; }
    th, td { padding:10px; text-align:center; }
    th { font-weight:bold; font-size:16px; }
    td { font-size:16px; cursor:pointer; }
    .total-row { font-weight:bold; background-color:#333; color:#008080; }
    .sum-col { background-color:#222; color:#0ff; }
    #search, #pn-search {
      width:80%; padding:12px; font-size:16px; border-radius:5px; border:none; margin:20px auto; display:block;
    }
    #search-result, #pn-result { margin-top:15px; }
    #search-result table, #pn-result table {
      margin-top:10px; border:2px solid #0ff; background-color:#333; width:100%;
    }
    #search-result th, #pn-result th { background-color:#008080; color:#000; }
    #search-result td, #pn-result td { color:#0ff; }
    /* –ú–æ–¥–∞–ª–∫–∞ */
    #modal { display:none; position:fixed; top:0; left:0; width:100%; height:100%; background: rgba(0,0,0,0.7); justify-content:center; align-items:center; z-index:10000; }
    #modal.show { display:flex; }
    #modal-content { background:#222; color:#0ff; padding:20px; border:2px solid #0ff; border-radius:10px; max-height:80%; overflow:auto; width:80%; max-width:900px; }
    #modal-close { background:#008080; color:#000; border:none; padding:5px 10px; cursor:pointer; font-weight:bold; margin-bottom:10px; }
    /* –ê–¥–∞–ø—Ç–∏–≤–Ω–æ—Å—Ç—å */
    @media (max-width: 900px) {
      .table-container { width:95%; }
      .header { padding:12px 4%; }
    }
  </style>
</head>
<body>
  <div class="header">
    <h1>LCDR LIVE DATA 2025</h1>
    <div class="date-info" id="date-info">DATE: --</div>
  </div>

  <div class="table-container">
    <!-- –ø–æ–∏—Å–∫ –ø–æ SN -->
    <input type="text" id="search" placeholder="Podaj SN (Enter)">
    <div id="search-result"></div>

    <!-- üîπ –ø–æ–∏—Å–∫ –ø–æ PN -->
    <input type="text" id="pn-search" placeholder="PN (Enter)">
    <div id="pn-result"></div>
  </div>

  <!-- (–æ—Å—Ç–∞–ª—å–Ω–∞—è —á–∞—Å—Ç—å —Ç–≤–æ–µ–≥–æ –∫–æ–¥–∞ ‚Äî —Ç–∞–±–ª–∏—Ü—ã, –º–æ–¥–∞–ª–∫–∞, JS —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏, —Ñ–æ–Ω –∏ —Ç.–¥.) -->

  <script>
    const apiKey = 'AIzaSyCP7tzYiGwIZ6cymLAlv_9QgPIEshnRgqI';
    const sheetId = '10W03bvKlVFlIUcxsHkzP_v_13gtnYRBmnrrO0ujB1bU'; 
    const sheetIdArchive = '1UWu4bcuHg6NHhK8ZvjDlQAIue6R1FLBlmAlBhHBj-D8'; 

    function buildSheetURL(spreadsheetId, sheetName){
      return `https://sheets.googleapis.com/v4/spreadsheets/${spreadsheetId}/values/${encodeURIComponent(sheetName)}?key=${apiKey}`;
    }

    async function getData(sheetName, spreadsheetId = sheetId){
      try{
        const res = await fetch(buildSheetURL(spreadsheetId, sheetName));
        if(!res.ok) throw new Error(res.statusText);
        const data = await res.json();
        return data.values || [];
      }catch(e){
        console.error(e);
        return [];
      }
    }

    // üîç –ü–æ–∏—Å–∫ –ø–æ SN
    async function searchSerial(serial){
      const sheet1 = await getData('FI Station KOVALCHYK Y.', sheetId);
      const sheet2 = await getData('FI Station 2 ULANOVYCH.R', sheetId);
      const sheet3 = await getData('2024', sheetIdArchive);
      const combined=[...(sheet1.slice(1)||[]),...(sheet2.slice(1)||[]),...(sheet3.slice(1)||[])];
      return combined.filter(r=>(r[2]||'')===serial).map(r=>({
        date:r[0]||"--", status:r[4]||"--", nameF:r[5]||"--", nameG:r[6]||"--", info:r[10]||"--"
      }));
    }

    document.getElementById('search').addEventListener('keypress', async e=>{
      if(e.key==='Enter'){
        const serial=e.target.value.trim();
        const output=document.getElementById('search-result');
        if(!serial){ output.innerHTML="<p style='color:red'>Podaj SN!</p>"; return; }
        output.innerHTML="<p style='color:lightblue'>Szukam...</p>";
        try{
          const data=await searchSerial(serial);
          if(data.length){
            const rows=data.map(d=>`<tr><td>${d.date}</td><td>${d.status}</td><td>${d.nameF}</td><td>${d.nameG}</td><td>${d.info}</td></tr>`).join('');
            output.innerHTML=`<table><thead><tr><th>Data</th><th>Status</th><th>NAPRAWIACZ</th><th>FINALNA</th><th>INFO</th></tr></thead><tbody>${rows}</tbody></table>`;
          }else output.innerHTML="<p style='color:yellow'>Brak info!</p>";
        }catch(err){ console.error(err); output.innerHTML="<p style='color:red'>–û—à–∏–±–∫–∞ –ø–æ–∏—Å–∫–∞</p>"; }
      }
    });

    // üîç –ü–æ–∏—Å–∫ –ø–æ PN (–Ω–æ–≤—ã–π)
    async function searchPN(pn){
      const data = await getData('pn', sheetIdArchive);
      return data.filter(r => (r[0]||'').trim().toUpperCase() === pn.trim().toUpperCase());
    }

    document.getElementById('pn-search').addEventListener('keypress', async e=>{
      if(e.key==='Enter'){
        const pn=e.target.value.trim();
        const out=document.getElementById('pn-result');
        if(!pn){ out.innerHTML="<p style='color:red'>–í–≤–µ–¥–∏—Ç–µ PN!</p>"; return; }
        out.innerHTML="<p style='color:lightblue'>–ü–æ–∏—Å–∫ PN...</p>";
        try{
          const data=await searchPN(pn);
          if(data.length){
            const rows=data.map(r=>`<tr><td>${r[0]||''}</td><td>${r[1]||''}</td><td>${r[2]||''}</td></tr>`).join('');
            out.innerHTML=`<table><thead><tr><th>PN</th><th>DESCRIPTION</th><th>LOCATION</th></tr></thead><tbody>${rows}</tbody></table>`;
          }else out.innerHTML="<p style='color:yellow'>–ù–µ –Ω–∞–π–¥–µ–Ω–æ!</p>";
        }catch(err){ out.innerHTML="<p style='color:red'>–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏!</p>"; }
      }
    });

    /* ‚¨áÔ∏è –û—Å—Ç–∞–ª—å–Ω–æ–π JS –∏–∑ –æ—Ä–∏–≥–∏–Ω–∞–ª–∞, –≤–∫–ª—é—á–∞—è —Å–º–µ–Ω—É —Ñ–æ–Ω–∞ ‚¨áÔ∏è */
    const backgrounds=[
      "https://raw.githubusercontent.com/iDLC1990/status-dashboard/main/pexels-carlos-oliva-1966452-3586966.jpg",
      "https://raw.githubusercontent.com/iDLC1990/status-dashboard/main/pexels-eberhardgross-1367192.jpg",
      "https://raw.githubusercontent.com/iDLC1990/status-dashboard/main/pexels-eberhardgross-640781.jpg",
      "https://raw.githubusercontent.com/iDLC1990/status-dashboard/main/pexels-francesco-ungaro-1526713.jpg",
      "https://raw.githubusercontent.com/iDLC1990/status-dashboard/main/pexels-iriser-1366957.jpg",
      "https://raw.githubusercontent.com/iDLC1990/status-dashboard/main/pexels-rickyrecap-2627063.jpg"
    ];
    let bgIndex=0;
    function changeBackground(){
      bgIndex=(bgIndex+1)%backgrounds.length;
      document.body.style.background=`url('${backgrounds[bgIndex]}') no-repeat center center fixed`;
      document.body.style.backgroundSize="cover";
    }
    setInterval(changeBackground,180000);
  </script>
</body>
</html>
