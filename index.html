<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>LCDR LIVE DATA</title>
<style>
body { font-family: Arial; background:#111; color:#fff; }
table { border-collapse: collapse; width:80%; margin:20px auto; }
th, td { border:1px solid #fff; padding:8px; text-align:center; }
th { background:#008080; color:#000; }
td { cursor:pointer; }
#modal {
  display:none;
  position:fixed; top:0; left:0; width:100%; height:100%;
  background: rgba(0,0,0,0.7);
  justify-content:center; align-items:center;
}
#modal.show { display:flex; }
#modal-content {
  background:#222; color:#0ff; padding:20px; border:2px solid #0ff; border-radius:10px; max-height:80%; overflow:auto;
}
#modal-close { background:#008080; color:#000; border:none; padding:5px 10px; cursor:pointer; margin-bottom:10px; }
#modal table { width:100%; }
#modal th, #modal td { border:1px solid #0ff; padding:5px; text-align:center; }
#modal th { background:#008080; color:#000; }
</style>
</head>
<body>

<h1 style="text-align:center;">LCDR LIVE DATA 2025</h1>
<div id="date-info" style="text-align:center;">DATE: --</div>

<table id="combined-table">
  <thead>
    <tr>
      <th>NAME</th><th>NDF</th><th>OK</th><th>WAITING</th><th>SCRAP TTL</th><th>SCRAP PNLA</th><th>SUMA CALKOWITA</th>
    </tr>
  </thead>
  <tbody></tbody>
</table>

<!-- Модалка -->
<div id="modal">
  <div id="modal-content">
    <button id="modal-close">Закрыть</button>
    <div id="modal-body"></div>
  </div>
</div>

<script>
// Пример данных
let combinedDataCache=[
  {name:"Иванов",serial:"ABC123",status:"OK",date:"2025-09-09 10:00"},
  {name:"Иванов",serial:"ABC124",status:"NDF",date:"2025-09-09 11:00"},
  {name:"Петров",serial:"DEF456",status:"OK",date:"2025-09-09 09:30"}
];

const lastDateStr="2025-09-09";
document.getElementById('date-info').textContent="DATE: "+lastDateStr;

const modal=document.getElementById('modal');
const modalBody=document.getElementById('modal-body');
document.getElementById('modal-close').addEventListener('click',()=>modal.classList.remove('show'));
modal.addEventListener('click',e=>{if(e.target===modal) modal.classList.remove('show');});

function openModal(name){
  const records=combinedDataCache.filter(r=>r.name===name && r.date.split(' ')[0]===lastDateStr);
  if(records.length===0){
    modalBody.innerHTML="<p>Нет данных за текущий день</p>";
  } else {
    const table=document.createElement('table');
    const thead=document.createElement('thead');
    const headRow=document.createElement('tr');
    headRow.innerHTML="<th>Serial</th><th>Status</th>";
    thead.appendChild(headRow);
    table.appendChild(thead);

    const tbody=document.createElement('tbody');
    records.forEach(r=>{
      const tr=document.createElement('tr');
      const td1=document.createElement('td'); td1.textContent=r.serial;
      const td2=document.createElement('td'); td2.textContent=r.status;
      tr.appendChild(td1); tr.appendChild(td2);
      tbody.appendChild(tr);
    });
    table.appendChild(tbody);
    modalBody.innerHTML="";
    modalBody.appendChild(table);
  }
  modal.classList.add('show');
}

function displayCombinedStats(){
  const stats={};
  combinedDataCache.forEach(r=>{
    if(!stats[r.name]) stats[r.name]={NDF:0,OK:0,WAITING:0,'SCRAP TTL':0,'SCRAP PNLA':0,total:0};
    if(r.status==="NDF") stats[r.name].NDF++;
    if(r.status==="OK") stats[r.name].OK++;
    stats[r.name].total++;
  });

  const tbody=document.querySelector('#combined-table tbody');
  tbody.innerHTML="";
  for(let name in stats){
    const row=document.createElement('tr');
    const tdName=document.createElement('td');
    tdName.textContent=name;
    tdName.addEventListener('click',()=>openModal(name));
    row.appendChild(tdName);

    ["NDF","OK","WAITING","SCRAP TTL","SCRAP PNLA","total"].forEach(k=>{
      const td=document.createElement('td'); td.textContent=stats[name][k]; row.appendChild(td);
    });

    tbody.appendChild(row);
  }
}

displayCombinedStats();
</script>

</body>
</html>
